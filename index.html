<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Выбор дат смен</title>
  <style>
    body { font-family: sans-serif; background-color: #f0f0f0; margin: 20px; }
    h2 { text-align: center; }
    .calendar-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
    .calendar { width: 300px; }
    .calendar h3 { text-align: center; margin-bottom: 10px; }
    .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .weekday { font-weight: bold; text-align: center; }
    .day { padding: 10px; text-align: center; border: 1px solid #ccc; cursor: pointer; }
    .day.disabled { color: #eee; cursor: default; }
    .day.selected { background: #4caf50; color: white; }
    .button { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; }
  </style>
  <!-- Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js" defer></script>
</head>
<body>
  <h2>Выберите даты смен</h2>
  <div class="calendar-container">
    <div class="calendar" id="calCurrent">
      <h3></h3>
      <div class="grid weekdays"></div>
      <div class="grid days"></div>
    </div>
    <div class="calendar" id="calNext">
      <h3></h3>
      <div class="grid weekdays"></div>
      <div class="grid days"></div>
    </div>
  </div>
  <!-- Fallback HTML submit button -->
  <button id="submit" class="button">Отправить</button>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tg = window.Telegram?.WebApp;
      if (!tg) {
        console.error('Telegram WebApp SDK not available');
        return;
      }
      tg.ready();
      tg.expand();
      tg.MainButton.setText('Отправить');
      tg.MainButton.show();

      // Generate calendars
      const weekdays = ['Пн','Вт','Ср','Чт','Пт','Сб','Вс'];
      const monthNames = ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'];
      function generateCalendar(id, year, month) {
        const cal = document.getElementById(id);
        cal.querySelector('h3').textContent = `${monthNames[month]} ${year}`;
        const wd = cal.querySelector('.weekdays'); wd.innerHTML = '';
        const daysGrid = cal.querySelector('.days'); daysGrid.innerHTML = '';
        weekdays.forEach(d => { const el = document.createElement('div'); el.className='weekday'; el.textContent=d; wd.appendChild(el); });
        const firstDay = new Date(year, month, 1).getDay();
        let offset = (firstDay + 6) % 7;
        for (let i = 0; i < offset; i++) { const el=document.createElement('div'); el.className='day disabled'; daysGrid.appendChild(el); }
        const daysCount = new Date(year, month+1, 0).getDate();
        for (let d =1; d <= daysCount; d++) {
          const el=document.createElement('div');
          el.className='day'; el.textContent=d;
          el.dataset.date=new Date(year, month, d).toISOString().slice(0,10);
          el.onclick = () => { if(!el.classList.contains('disabled')) el.classList.toggle('selected'); updateButton(); };
          daysGrid.appendChild(el);
        }
      }
      const today=new Date();
      generateCalendar('calCurrent', today.getFullYear(), today.getMonth());
      const nextMonth = today.getMonth() === 11 ? 0 : today.getMonth()+1;
      const nextYear = today.getMonth() === 11 ? today.getFullYear()+1 : today.getFullYear();
      generateCalendar('calNext', nextYear, nextMonth);

      function updateButton() {
        const has = document.querySelectorAll('.day.selected').length>0;
        tg.MainButton[has?'enable':'disable']();
      }
      updateButton();

      function sendSelectedDates() {
        const dates = Array.from(document.querySelectorAll('.day.selected')).map(el => el.dataset.date);
        if (dates.length === 0) {
          alert('Выберите хотя бы одну дату.');
          return;
        }
        tg.sendData(JSON.stringify(dates));
        if (typeof tg.close === 'function') tg.close();
      }
      // Native Telegram MainButton click
      if (tg.MainButton && typeof tg.MainButton.onClick === 'function') {
        tg.MainButton.onClick(sendSelectedDates);
      } else if (typeof tg.onEvent === 'function') {
        // fallback for older SDK
        tg.onEvent('mainButtonClicked', sendSelectedDates);
      }
      // Fallback HTML button click
      const submitBtn = document.getElementById('submit');
      if (submitBtn) {
        submitBtn.addEventListener('click', sendSelectedDates);
      }
    });
  </script>
</body>
</html> 
